# このディレクトリーはvibe-kanbanの運用ルールを定義します

# 前提
- 実装して動かすことよりも設計を重視します。設計もまた品質の高い設計を最初から行うことを重視します。
- エージェントのアウトプットが十分予測可能になるまで事前のカードの内容を具体化して進めます
- 実装はエージェントが行いますが、エンジニアがコードを100%理解しながら進めることを要求します。
- つまりvibeコーディングの逆を行います

# 基本的な流れ
Epic -> Objective -> Spec(MRC) -> Micro(LM)

# 説明
各段階に分割する際に、同時にレビュー用のカードを作成してください。
レビューにより修正点があった場合は設計内容を修正していきます。

## Epic
- 最上位のカード
- なぜやるか?とやりたいことを記述する
- ユーザー価値につながるものはユーザーストーリーを記述する
- プロダクト価値につながるものはその説明を記述する(パフォーマンス改善、計測可能性の改善、コードの複雑さの低減など)
- OUTPUT Objectiveカードを作成する

## Objective
- Epicに紐づく、上流設計粒度のカード
  - 多くの場合はEpicと1対1で済むので無理して分けなくていい
- カードに設計内容を記述する。このカードの時点で設計の妥当性を判断できる程度に詳細化すること
- タイトル: [Objective] Objectiveの内容
- OUTPUT Specカードを作成する

## Spec
- Objectiveに紐づく、詳細設計の粒度
- 開発タスクにおいてはMRCとなる大きさでPRを作成する
- インフラ、アーキテクチャレベルの意思決定はここで行う
  - 永続化層や、具体的にどのAPIをどのペースで叩くのか?などの意思決定も含まれる。そのため技術検証も含まれる。この場合は検証結果のドキュメントを作成し、PRを作るのが良い
  - 技術検証タスクではMicroは不要
  - 結果に応じてObjectiveに戻して、更にObejctiveからSpecを切ってもらうケースもありうる。
- 具体的にどのクラスにどのような振る舞いを追加するのかわかる程度に具体化する
- UI要素であれば、どのような要素が追加されるのか?どのように追加されるのか(縦方向に並ぶなど)?振る舞いがある場合はどのような振る舞いか?を具体的に記述する
- OUTPUT Microカードを作成する

## Micro
Microは実務を担当する。
- Codingタスク
  - Specに紐づく開発、実装タスクの粒度
  - レビューの認知不可を下げるために、1ファンクション単位、インターフェース追加程度の粒度で作成する
  - カードの記述内容だけで実装内容が完全にわかるくらい詳細に記述する
  - 例えばUI(HTML)要素であれば、まず縦方向に深くn段階掘るカードを1つ、同じ深さで横に並べるためのカードを1つ程度の詳細さ
  - Small-CLを意識し、コード変更は20行以下、1ファイルを目安とする

- Researchタスク
  - 技術調査、インターネット情報の調査が必要なタスク
  - 情報の整理をしたうえで、根拠を元にドキュメント化を行う
  - アウトプットはマークダウンに記述し、日本語にすること
- Documentationタスク
  - ドキュメンテーション全般を担う
  - アウトプットはマークダウンに記述し、日本語にすること

# その他カードテンプレート
## Epicレビュー
Epicの内容の妥当性を検証する
何をやりたいかわかるか?
ユーザー価値が実現できそうか?
ユーザー価値は妥当が?
解決策の筋はよさそうか?
システムが複雑になりすぎないか?
基本的に機能は増やさないほうがシステムにとってはポジティブであることを忘れずに。


## Objectiveレビュー
Objectiveカードの内容をレビューする
Epicの目的を達成できているか?
設計が妥当か?
技術的課題はないか?
低品質な設計になっていないか?
複雑すぎる設計になっていないか?
運用が難しい設計になっていないか?
Specカードがある場合は、あわせてレビューする
必要であればエンジニアの承認を得たうえで再設計を行いカードを修正する

## Specレビュー
Specカードの内容をレビューする
Objectiveの設計と整合しているか?
技術的課題はないか?
低品質な設計になっていないか?
複雑すぎる設計になっていないか?
運用が難しい設計になっていないか?
Microカードがある場合は、あわせてレビューする
必要であればエンジニアの承認を得たうえで再設計を行いカードを修正する


# AIエージェント
## Epic_Planner
入力: Epicカード
出力: 実現方法を検討し、上流設計を行い、結果をEpicカードへ反映する
Objectiveカードを作成する
Epicレビューカードを作成する
実装は行わない


## Objective_Planner
入力: Objectiveカード
出力: 実現方法を検討し、詳細設計を行い、結果をObjectiveカードへ反映する
Specカードを作成する
Objectiveレビューカードを作成する
実装は行わない

## Spec_Planner
入力: Specカード
出力: 実現方法を検討し、詳細な実装内容を設計し、結果をSpecカードへ反映する
Microカードを作成する
Specレビューカードを作成する
実装は行わない

## Coder
Microの実装タスクを割り当てる制約違反は失敗で返す。

## Researcher
MicroのResearchタスクを割り当てる。技術検証、調査が必要なタスクを担当する

## Doc_Writer
MicroのDocumetationタスクを割り当てる。

## Reviewer
レビュータスクを担当。設計に技術的問題がないか、低品質な設計になっていないかをレビューする
レビュー対象のカードの更新内容を提案する


## カード管理ルール

### カードの構造
- Epic/Objective/Spec/Microは**それぞれ独立したカード**として作成
- 各カードの冒頭に親階層の情報を明記

### 親子関係の記載フォーマット
**親Epic**: [Epic名] (ID: `xxxxx`)
**親Objective**: [Objective名] (ID: `xxxxx`)
**親Spec**: [Spec名] (ID: `xxxxx`)

### タイトル命名規則
- Epic: `[Epic] 機能名`
- Objective: `[Objective] 設計名`
- Spec: `[Spec] 詳細設計名`
- Micro: `[Micro] 実装タスク名`
- 作成タスク: `Make [階層] [対象名]`